{%- from "macros.j2" import summary_with_toggle -%}
{% extends "common_dashboard.j2" %}
{# Auto-reload behavior:
   - common_dashboard.j2 polls the current file and reloads only if it changed.
   - Match local/remote dashboards (show_local_branches.j2) which poll every 15s. #}
{% set refresh_check_interval_ms = 15000 %}

{% block title %}Dynamo Commit History (last {{ commit_count }} commits){% endblock %}
{% block favicon %}<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='15' y='55' width='70' height='20' rx='3' fill='%232196f3'/><rect x='20' y='40' width='60' height='20' rx='3' fill='%234caf50'/><rect x='25' y='25' width='50' height='20' rx='3' fill='%23ff9800'/></svg>">{% endblock %}

{% block css %}
.container {
    background-color: white;
    border: 1px solid #d0d7de;
    border-radius: 4px;
    /* Allow the table to grow wider than the viewport so the *page* can scroll horizontally. */
    overflow: visible;
}
#commits-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: auto;
}
#commits-table th {
    background-color: #f6f8fa;
    padding: 6px 8px;
    text-align: left;
    font-weight: 600;
    border-bottom: 1px solid #d0d7de;
    position: sticky;
    top: 0;
    font-size: 12px;
    white-space: nowrap;
}
#commits-table td {
    padding: 4px 8px;
    border-bottom: 1px solid #d0d7de;
    vertical-align: middle;
    line-height: 1.2;
}
/* Message column: do not truncate or add an inner scrollbar; let the page scroll horizontally. */
td.col-message {
    white-space: nowrap;
}
/* Prevent wrapping in other columns */
.sha, .date, .author {
    white-space: nowrap;
}
/* Commit SHA styling */
.sha a {
    padding: 2px 6px;
    border-radius: 3px;
    display: inline-block;
}
/* Commit SHA background colors - alternates based on Image SHA */
.sha-color-0 { background-color: #fff9c4; } /* Light yellow */
.sha-color-1 { background-color: #f3e5f5; } /* Light purple */
.sha-color-2 { background-color: #c8e6c9; } /* Light green */
.sha-color-3 { background-color: #ffe0b2; } /* Light orange */
.sha-color-4 { background-color: #e3f2fd; } /* Light blue */
.sha-color-5 { background-color: #b2ebf2; } /* Light cyan */
.sha-color-6 { background-color: #dcedc8; } /* Light lime */
.sha-color-7 { background-color: #e1bee7; } /* Light lavender */
#commits-table tr:hover {
    background-color: #f6f8fa;
}
.sha {
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    font-size: 12px;
    white-space: nowrap;
}
.sha a {
    color: #0969da;
    text-decoration: none;
}
.sha a:hover {
    text-decoration: underline;
}
.icon-link {
    text-decoration: none;
    display: inline-block;
    margin: 0;
    padding: 0;
    line-height: 1;
    vertical-align: middle;
}
.gitlab-icons {
    display: inline-flex;
    align-items: center;
    gap: 0; /* avoid flex-gap interacting with template whitespace */
    white-space: nowrap;
}
.gitlab-icons .triangle-toggle,
.gitlab-icons .triangle-toggle.disabled {
    margin-right: 4px !important;
}
.gitlab-icons a.icon-link,
.gitlab-icons span.icon-link {
    margin: 0;
    padding: 0;
    line-height: 1;
}
.gitlab-icons a.gitlab-commit-link {
    margin-right: 6px;
}
.gitlab-icons a.gitlab-registry-link {
    margin-right: 6px;
}
.github-icons {
    display: inline-flex;
    align-items: center;
    white-space: nowrap;
    gap: 0; /* avoid flex-gap interacting with template whitespace */
}
.github-icons .triangle-toggle,
.github-icons .triangle-toggle.disabled {
    margin-right: 2px !important;
}
.github-icons a.github-commit-link {
    margin-right: 2px;
}
.github-icons .gh-status-tooltip {
    margin-left: 0 !important;
}
.github-icons .gh-status-tooltip > span {
    margin-left: 0 !important;
}
.image-status-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 12px;
    height: 12px;
    border-radius: 999px;
    margin: 0;
    padding: 0;
    line-height: 1;
    font-weight: 900;
    font-size: 10px;
    flex-shrink: 0;
    vertical-align: middle;
    box-sizing: border-box;
}
.image-status-success {
    background-color: #2da44e;
    color: #ffffff;
}
.image-status-failed {
    background-color: #d1242f;
    color: #ffffff;
}
.image-status-building {
    background-color: #bf8700;
    color: #ffffff;
    font-size: 9px;
}
.image-status-unknown {
    /* much more subtle than a filled gray circle */
    background-color: transparent;
    border: 1px solid #d0d7de;
    opacity: 0.8;
}
.icon-link:hover {
    opacity: 0.9;
}
.icon-muted {
    filter: grayscale(1);
    opacity: 0.55;
}
.message {
    color: #24292f;
}

/* Triangle toggle rotation animation (300ms) */
.triangle-toggle {
    display: inline-block;
    transition: transform 300ms ease;
    transform-origin: center;
}
.triangle-toggle.expanded {
    transform: rotate(90deg);
}
/* For details/summary elements, rotate when open */
details[open] > summary .triangle-toggle {
    transform: rotate(90deg);
}

/* Make Message column consume remaining space when visible. */
th.col-message,
td.col-message {
    width: 100%;
}
.pr-link {
    color: #0969da;
    text-decoration: none;
    font-weight: 500;
}
.pr-link:hover {
    text-decoration: underline;
}
.image-sha-text-link {
    color: #0969da;
    text-decoration: none;
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    font-size: 12px;
    white-space: nowrap;
}
.image-sha-text-link:hover {
    text-decoration: underline;
}
.image-sha-badge {
    display: inline-block;
    padding: 0px 4px !important;
    border-radius: 4px;
    font-size: 12px;
    line-height: 1.4;
    vertical-align: middle;
    border: none !important;
    text-decoration: none;
    box-sizing: border-box;
}
/* Only clickable IMAGE:... should underline on hover. */
a.image-sha-badge {
    border: none !important;
    padding: 0px 4px !important;
    box-sizing: border-box;
    text-decoration: underline dotted;
    text-underline-offset: 1px;
    text-decoration-thickness: 1px;
}
a.image-sha-badge:hover {
    text-decoration: underline solid;
    text-underline-offset: 1px;
    text-decoration-thickness: 1px;
}
.release-forkpoint {
    display: inline-block;
    margin-left: 6px;
    padding: 1px 6px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 600;
    color: #0969da;
    background-color: #ddf4ff;
    border: 1px solid #80ccff;
    text-decoration: none;
    white-space: nowrap;
}
.release-forkpoint:hover {
    background-color: #b6e3ff;
    border-color: #54aeff;
    color: #0550ae;
    text-decoration: none;
}
.docker-images {
    margin-top: 8px;
}
.container details,
.legend details {
    margin-top: 4px;
}
.container summary,
.legend summary {
    cursor: pointer;
    color: #0969da;
    font-size: 13px;
    font-weight: 500;
}
/* Summary hover should NOT underline; underline is reserved for actual links (<a>). */
.container summary:hover,
.legend summary:hover {
    text-decoration: none;
}
.image-list {
    margin: 8px 0;
    padding-left: 20px;
}
.image-tag {
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    font-size: 12px;
    background-color: #f6f8fa;
    padding: 2px 6px;
    border-radius: 3px;
    display: block;
    margin: 4px 0;
}
.date {
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    color: #57606a;
    font-size: 12px;
}
.author {
    color: #24292f;
    font-size: 14px;
}

/* Column visibility toggles (controlled by header checkboxes).
 *
 * IMPORTANT: do NOT `display:none` table cells. That changes the cell count per row and causes
 * columns to shift left, misaligning header vs body.
 *
 * Policy: keep the header cell visible so the checkbox remains available to re-enable the column.
 * When collapsed, hide the cell's contents and shrink the column width.
 */
#commits-table.hide-col-composite td.col-composite,
#commits-table.hide-col-github td.col-github,
#commits-table.hide-col-gitlab td.col-gitlab,
#commits-table.hide-col-date td.col-date,
#commits-table.hide-col-author td.col-author,
#commits-table.hide-col-email td.col-email,
#commits-table.hide-col-message td.col-message {
    width: 1% !important;
    max-width: 1px;
    overflow: hidden;
    white-space: nowrap;
    padding-left: 6px;
    padding-right: 6px;
}

#commits-table.hide-col-composite td.col-composite .col-body,
#commits-table.hide-col-github td.col-github .col-body,
#commits-table.hide-col-gitlab td.col-gitlab .col-body,
#commits-table.hide-col-date td.col-date .col-body,
#commits-table.hide-col-author td.col-author .col-body,
#commits-table.hide-col-email td.col-email .col-body,
#commits-table.hide-col-message td.col-message .col-body {
    display: none;
}

#commits-table.hide-col-composite th.col-composite .col-title-text,
#commits-table.hide-col-github th.col-github .col-title-text,
#commits-table.hide-col-gitlab th.col-gitlab .col-title-text,
/* Date column special-case: keep "PST" visible even when collapsed (requested). */
#commits-table.hide-col-author th.col-author .col-title-text,
#commits-table.hide-col-email th.col-email .col-title-text,
#commits-table.hide-col-message th.col-message .col-title-text {
    display: none;
}

#commits-table.hide-col-composite th.col-composite,
#commits-table.hide-col-github th.col-github,
#commits-table.hide-col-gitlab th.col-gitlab,
#commits-table.hide-col-date th.col-date,
#commits-table.hide-col-author th.col-author,
#commits-table.hide-col-email th.col-email,
#commits-table.hide-col-message th.col-message {
    width: 1% !important;
    padding-right: 6px;
    opacity: 0.9;
}

.col-toggle {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    user-select: none;
}

.col-toggle-flex {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 6px;
    user-select: none;
    width: 100%;
}

.col-left {
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.col-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #57606a;
}

.date-header-controls {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    white-space: nowrap;
}

.date-header-controls .col-toggle {
    gap: 6px;
}

.col-toggle input[type="checkbox"] {
    margin: 0;
    transform: translateY(0.5px);
}
.composite-sha-link {
    color: #0969da;
    text-decoration: none;
    cursor: pointer;
    border-bottom: 1px dotted #0969da;
}
.composite-sha-link:hover {
    text-decoration: underline;
}
.status-indicator {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    margin-right: 6px;
    vertical-align: middle;
    font-size: 10px;
    font-weight: 600;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    border: 1px solid transparent;
}
a .status-indicator {
    cursor: pointer;
}
a .status-indicator:hover {
    opacity: 0.85;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
.status-success {
    background-color: #2da44e;
    border-color: #1f7a37;
}
.status-failed {
    background-color: #c83a3a;
    border-color: #a83232;
}
.status-building {
    background-color: #8c959f;
    border-color: #6e7781;
}
.status-success-inherited {
    background-color: #a8d5ba;
    border-color: #7bb697;
    color: #1f7a37;
}
.status-failed-inherited {
    background-color: #f5a3ab;
    border-color: #e67c87;
    color: #a83232;
}
.status-building-inherited {
    background-color: #eaeef2;
    border-color: #d0d7de;
    color: #57606a;
}
.status-unknown {
    background-color: transparent;
    border: 1px solid #8c959f;
    color: #8c959f;
}
{% endblock %}

{% block head_script %}
<script>

function toggleDockerImages(event, linkElement) {
    event.preventDefault();
    // If URL state wants to target this, we rely on `data-sha-short` and stable row ids.
    var shaShort = '';
    try { shaShort = String(linkElement.getAttribute('data-sha-short') || ''); } catch (e) { shaShort = ''; }
    // Find the current row
    var currentRow = linkElement.closest('tr');
    // Find the docker-images-row.
    // NOTE: There may be intermediate rows (e.g., checks tree row), so scan forward.
    var dockerRow = currentRow ? currentRow.nextElementSibling : null;
    while (dockerRow && !(dockerRow.classList && dockerRow.classList.contains('docker-images-row'))) {
        dockerRow = dockerRow.nextElementSibling;
    }

    if (dockerRow && dockerRow.classList.contains('docker-images-row')) {
        // Toggle visibility
        if (dockerRow.style.display === 'none') {
            dockerRow.style.display = 'table-row';
            try { linkElement.classList.add('expanded'); } catch (e) {}
            try { if (window.DashboardUrlState && shaShort) { window.DashboardUrlState.setBoolDefault('d.' + shaShort, true, false); } } catch (e) {}
        } else {
            dockerRow.style.display = 'none';
            try { linkElement.classList.remove('expanded'); } catch (e) {}
            try { if (window.DashboardUrlState && shaShort) { window.DashboardUrlState.setBoolDefault('d.' + shaShort, false, false); } } catch (e) {}
        }
    }
}

function collapseDockerImages(shaShort) {
    // Collapse docker images row and reset its toggle triangle + URL state.
    var row = document.getElementById('docker-row-' + shaShort);
    var toggleEl = document.getElementById('docker-toggle-' + shaShort);
    if (row) {
        row.style.display = 'none';
    }
    if (toggleEl) {
        try { toggleEl.classList.remove('expanded'); } catch (e) {}
    }
    try { if (window.DashboardUrlState && shaShort) { window.DashboardUrlState.setBoolDefault('d.' + shaShort, false, false); } } catch (e) {}
}

function toggleCommitGitHubTree(event, shaShort) {
    event.preventDefault();
    event.stopPropagation();
    var row = document.getElementById('github-tree-row-' + shaShort);
    var toggleEl = document.getElementById('github-tree-toggle-' + shaShort);
    if (!row) return;
    var hidden = (row.style.display === 'none' || row.style.display === '');
    row.style.display = hidden ? 'table-row' : 'none';
    if (toggleEl) {
        try { toggleEl.classList.toggle('expanded', hidden); } catch (e) {}
    }
    try { if (window.DashboardUrlState) { window.DashboardUrlState.setBoolDefault('gh.' + String(shaShort || ''), hidden, false); } } catch (e) {}
}

function collapseCommitGitHubTree(shaShort) {
    var row = document.getElementById('github-tree-row-' + shaShort);
    var toggleEl = document.getElementById('github-tree-toggle-' + shaShort);
    if (!row) return;
    row.style.display = 'none';
    if (toggleEl) {
        try { toggleEl.classList.remove('expanded'); } catch (e) {}
    }
    try { if (window.DashboardUrlState) { window.DashboardUrlState.setBoolDefault('gh.' + String(shaShort || ''), false, false); } } catch (e) {}
}

function toggleCommitInfo(event, shaShort) {
    event.preventDefault();
    event.stopPropagation();
    var row = document.getElementById('commit-info-row-' + shaShort);
    var toggleEl = document.getElementById('commit-info-toggle-' + shaShort);
    if (!row) return;
    var hidden = (row.style.display === 'none' || row.style.display === '');
    row.style.display = hidden ? 'table-row' : 'none';
    if (toggleEl) {
        try { toggleEl.classList.toggle('expanded', hidden); } catch (e) {}
    }
    try { if (window.DashboardUrlState) { window.DashboardUrlState.setBoolDefault('ci.' + String(shaShort || ''), hidden, false); } } catch (e) {}
}

function collapseCommitInfo(shaShort) {
    var row = document.getElementById('commit-info-row-' + shaShort);
    var toggleEl = document.getElementById('commit-info-toggle-' + shaShort);
    if (!row) return;
    row.style.display = 'none';
    if (toggleEl) {
        try { toggleEl.classList.remove('expanded'); } catch (e) {}
    }
    try { if (window.DashboardUrlState) { window.DashboardUrlState.setBoolDefault('ci.' + String(shaShort || ''), false, false); } } catch (e) {}
}

function toggleCommitGitLabTree(event, shaShort) {
    event.preventDefault();
    event.stopPropagation();
    var row = document.getElementById('gitlab-tree-row-' + shaShort);
    var toggleEl = document.getElementById('gitlab-tree-toggle-' + shaShort);
    if (!row) return;
    var hidden = (row.style.display === 'none' || row.style.display === '');
    row.style.display = hidden ? 'table-row' : 'none';
    if (toggleEl) {
        try { toggleEl.classList.toggle('expanded', hidden); } catch (e) {}
    }
    try { if (window.DashboardUrlState) { window.DashboardUrlState.setBoolDefault('gl.' + String(shaShort || ''), hidden, false); } } catch (e) {}
}

function collapseCommitGitLabTree(shaShort) {
    var row = document.getElementById('gitlab-tree-row-' + shaShort);
    var toggleEl = document.getElementById('gitlab-tree-toggle-' + shaShort);
    if (!row) return;
    row.style.display = 'none';
    if (toggleEl) {
        try { toggleEl.classList.remove('expanded'); } catch (e) {}
    }
    try { if (window.DashboardUrlState) { window.DashboardUrlState.setBoolDefault('gl.' + String(shaShort || ''), false, false); } } catch (e) {}
}

function toggleBuildHistory(event, shaShort) {
    event.preventDefault();
    event.stopPropagation();

    var historyDiv = document.getElementById('build-history-' + shaShort);

    // Close all other build history dropdowns
    var allHistories = document.querySelectorAll('[id^="build-history-"]');
    allHistories.forEach(function(div) {
        if (div.id !== 'build-history-' + shaShort) {
            div.style.display = 'none';
        }
    });

    // Toggle this one
    if (historyDiv.style.display === 'none' || historyDiv.style.display === '') {
        historyDiv.style.display = 'block';
    } else {
        historyDiv.style.display = 'none';
    }
}

// Close build history dropdown when clicking outside
document.addEventListener('click', function(event) {
    if (!event.target.closest('[onclick^="toggleBuildHistory"]') &&
        !event.target.closest('[id^="build-history-"]')) {
        var allHistories = document.querySelectorAll('[id^="build-history-"]');
        allHistories.forEach(function(div) {
            div.style.display = 'none';
        });
    }
});

function _commitTable() {
    return document.getElementById('commits-table');
}

function applyCommitColumn(colKey, enabled, persist) {
    var table = _commitTable();
    if (!table) return;
    var cls = 'hide-col-' + colKey;
    table.classList.toggle(cls, !enabled);
    try {
        if (persist) {
            // Versioned key so we can change defaults without old localStorage overriding UX forever.
            localStorage.setItem('commitHistoryCol:v3:' + colKey, enabled ? '1' : '0');
        }
    } catch (e) {}
}

function toggleCommitColumn(cb) {
    if (!cb) return;
    var key = cb.getAttribute('data-col') || '';
    if (!key) return;
    applyCommitColumn(key, !!cb.checked, true);
}

function initCommitColumnToggles() {
    var table = _commitTable();
    if (!table) return;
    var cbs = document.querySelectorAll('input.commit-col-toggle[data-col]');
    cbs.forEach(function(cb) {
        var key = cb.getAttribute('data-col') || '';
        if (!key) return;
        // URL overrides everything when present (DashboardUrlState will have set `cb.checked` already).
        try {
            if (window.DashboardUrlState && window.DashboardUrlState.has('col.' + key)) {
                applyCommitColumn(key, !!cb.checked, false);
                return;
            }
        } catch (e) {}
        // Force a stable default regardless of browser form-state restoration.
        // (localStorage may override below.)
        try {
            var def = cb.getAttribute('data-url-default');
            if (def === null || def === undefined || String(def) === '') {
                def = cb.getAttribute('data-url-state');  // backward compat
            }
            cb.checked = (String(def || '') === '1');
        } catch (e) {}
        try {
            var saved = localStorage.getItem('commitHistoryCol:v3:' + key);
            if (saved === '0' || saved === '1') {
                cb.checked = (saved === '1');
            }
        } catch (e) {}
        applyCommitColumn(key, !!cb.checked, false);
    });
}

// Date/Time mode toggle (absolute vs "time ago")
var _commitDateModeTimer = null;

function _pad2(n) {
    n = parseInt(n || 0, 10);
    return (n < 10 ? '0' : '') + String(n);
}

function _formatAgo(seconds) {
    var s = Math.max(0, Math.floor(seconds || 0));
    if (s < 60) {
        return String(s) + 's ago';
    }
    if (s < 3600) {
        var m = Math.floor(s / 60);
        var rem = s % 60;
        return String(m) + 'm ' + _pad2(rem) + 's ago';
    }
    if (s < 86400) {
        var h = (s / 3600).toFixed(1);
        return String(h) + ' hours ago';
    }
    var d = (s / 86400).toFixed(1);
    return String(d) + ' days ago';
}

function _updateCommitAges() {
    var nowSec = Math.floor(Date.now() / 1000);
    var nodes = document.querySelectorAll('.dt-ago[data-epoch]');
    nodes.forEach(function(el) {
        var ep = parseInt(el.getAttribute('data-epoch') || '0', 10);
        if (!ep) return;
        el.textContent = _formatAgo(nowSec - ep);
    });
}

function applyCommitDateMode(mode, persist) {
    var m = (mode === 'ago') ? 'ago' : 'abs';
    var showAgo = (m === 'ago');
    document.querySelectorAll('.dt-abs').forEach(function(el) { el.style.display = showAgo ? 'none' : ''; });
    document.querySelectorAll('.dt-ago').forEach(function(el) { el.style.display = showAgo ? '' : 'none'; });
    if (showAgo) {
        _updateCommitAges();
        if (_commitDateModeTimer === null) {
            // Update frequently so the "ago" labels feel live (similar to the page-age ticker).
            _commitDateModeTimer = window.setInterval(_updateCommitAges, 5000);
        }
    } else {
        if (_commitDateModeTimer !== null) {
            window.clearInterval(_commitDateModeTimer);
            _commitDateModeTimer = null;
        }
    }
    if (persist) {
        try { localStorage.setItem('commitHistoryDateMode', m); } catch (e) {}
    }
}

function toggleCommitDateMode(cb) {
    applyCommitDateMode(cb && cb.checked ? 'ago' : 'abs', true);
}

function initCommitDateModeToggle() {
    var cb = document.querySelector('input.commit-date-mode-toggle');
    if (!cb) return;
    // URL overrides localStorage when present.
    try {
        if (window.DashboardUrlState && window.DashboardUrlState.has('date.mode')) {
            applyCommitDateMode(cb.checked ? 'ago' : 'abs', false);
            return;
        }
    } catch (e) {}
    // Force a stable default from data-url-default (like column toggles do).
    var mode = 'abs';
    try {
        var def = cb.getAttribute('data-url-default');
        if (def === null || def === undefined || String(def) === '') {
            def = cb.getAttribute('data-url-state');  // backward compat
        }
        // data-url-default="0" means unchecked (abs), "1" means checked (ago)
        mode = (String(def || '') === '1') ? 'ago' : 'abs';
    } catch (e) {}
    // Then check localStorage override
    try {
        var saved = localStorage.getItem('commitHistoryDateMode');
        if (saved === 'ago' || saved === 'abs') {
            mode = saved;
        }
    } catch (e) {}
    cb.checked = (mode === 'ago');
    applyCommitDateMode(mode, false);
}

// Register a "ready" callback without depending on DOMContentLoaded handler registration order.
// common_dashboard.j2 will call DashboardUrlState.init() first, then run this queue.
window.__dashboardOnReadyQueue = window.__dashboardOnReadyQueue || [];
window.__dashboardOnReadyQueue.push(function() {
    initCommitColumnToggles();
    initCommitDateModeToggle();
    // Apply commit-history-specific expansion toggles encoded in the URL.
    try {
        // Merge search + hash params (hash is supported when it looks like `#k=v&...`).
        var params = new URLSearchParams(window.location.search || '');
        try {
            var h = String(window.location.hash || '');
            if (h && h.indexOf('=') !== -1) {
                var hs = h.startsWith('#') ? h.slice(1) : h;
                var hp = new URLSearchParams(hs);
                hp.forEach(function(v, k) { if (!params.has(k)) params.set(k, v); });
            }
        } catch (e) {}

        params.forEach(function(v, k) {
            try {
                var ks = String(k || '');
                var vv = String(v || '').trim().toLowerCase();
                var wantOpen = (vv === '1' || vv === 'true' || vv === 'yes' || vv === 'on');
                if (ks.startsWith('d.')) {
                    var sha = ks.slice('d.'.length);
                    if (!sha) return;
                    var row = document.getElementById('docker-row-' + sha);
                    var tg = document.getElementById('docker-toggle-' + sha);
                    if (row) row.style.display = wantOpen ? 'table-row' : 'none';
                    if (tg) {
                        try { tg.classList.toggle('expanded', wantOpen); } catch (e) {}
                    }
                    return;
                }
                if (ks.startsWith('gh.')) {
                    var sha2 = ks.slice('gh.'.length);
                    if (!sha2) return;
                    var r2 = document.getElementById('github-tree-row-' + sha2);
                    var t2 = document.getElementById('github-tree-toggle-' + sha2);
                    if (r2) r2.style.display = wantOpen ? 'table-row' : 'none';
                    if (t2) {
                        try { t2.classList.toggle('expanded', wantOpen); } catch (e) {}
                    }
                    return;
                }
                if (ks.startsWith('gl.')) {
                    var sha3 = ks.slice('gl.'.length);
                    if (!sha3) return;
                    var r3 = document.getElementById('gitlab-tree-row-' + sha3);
                    var t3 = document.getElementById('gitlab-tree-toggle-' + sha3);
                    if (r3) r3.style.display = wantOpen ? 'table-row' : 'none';
                    if (t3) {
                        try { t3.classList.toggle('expanded', wantOpen); } catch (e) {}
                    }
                    return;
                }
            } catch (e) {}
        });
    } catch (e) {}
});

// copyToClipboard / copyFromClipboardAttr are provided by common_dashboard.j2
</script>
{% endblock %}

{% block header_title %}
<span>Dynamo Commit History (last {{ commit_count }} commits)</span>
<span class="header-meta">Page generated: {{ generated_time }} <span id="page-age" class="page-age"></span></span>
{% endblock %}
{% block header_subtitle %}{% endblock %}

{% block content %}

<!-- Key/Help Section -->
<!-- NOTE: Do NOT use `.container` here; `.container` has a border and looks "boxed".
     Match the branches dashboard legend style (no border/box). -->
<div class="legend" style="margin-bottom: 0px; padding: 8px; background-color: #f6f8fa;">
<details style="margin-top: 0;" data-url-state="1" data-url-key="legend">
{{ summary_with_toggle('Legend &amp; Help', right_html='<button type="button" onclick="event.preventDefault(); event.stopPropagation(); try { DashboardUrlState.resetView({reload: false}); } catch (e) {}" style="padding: 2px 8px; font-size: 11px; line-height: 1.2; background: transparent; color: #0969da; border: 1px solid #0969da; border-radius: 999px; cursor: pointer;" title="Reset view state (clears URL params and restores defaults)">Reset view</button>') }}
<div class="details-body">
<div style="margin-top: 10px; font-size: 12px; line-height: 1.55;">
<div style="margin-bottom: 12px;">
<div style="font-weight: 600; margin-bottom: 6px; color: #24292f;">GitHub Status:</div>
<ul style="margin: 4px 0; padding-left: 20px;">
<li>{{ success_required_icon_html|safe }} / {{ success_icon_html|safe }} - Passed (required/optional)</li>
<li>{{ failure_required_icon_html|safe }} / {{ failure_optional_icon_html|safe }} - Failed (required/optional)</li>
<li>{{ in_progress_icon_html|safe }} - In progress or running</li>
<li>{{ pending_icon_html|safe }} - Pending (not started)</li>
<li>{{ cancelled_icon_html|safe }} - Canceled</li>
<li>{{ skipped_icon_html|safe }} - Skipped</li>
<li><strong style="color: #8c959f;">‚óá</strong> - Expected (inferred from workflow YAML, not yet reported by API)</li>
</ul>
</div>

<div style="margin-bottom: 12px;">
<div style="font-weight: 600; margin-bottom: 6px; color: #24292f;">Job Steps:</div>
<ul style="margin: 4px 0; padding-left: 20px;">
<li><strong>Build and Test - dynamo</strong> shows phase breakdown (Build Image, Rust checks, pytest...)</li>
<li><strong>Long-running jobs</strong> (‚â•10 min) show steps with duration ‚â•30s</li>
</ul>
</div>

<div style="margin-bottom: 12px;">
<div style="font-weight: 600; margin-bottom: 6px; color: #24292f;">GitLab Status:</div>
<ul style="margin: 4px 0; padding-left: 20px;">
<li><strong>ü¶ä</strong> - Opens commit on NVIDIA GitLab</li>
<li><strong>üõ†Ô∏è</strong> - Opens GitLab pipeline/run</li>
</ul>
</div>

<div style="margin-bottom: 12px;">
<div style="font-weight: 600; margin-bottom: 6px; color: #24292f;">Images &amp; Links:</div>
<ul style="margin: 4px 0; padding-left: 20px;">
<li><strong>IMAGE:xxxxxx</strong> - Image SHA for container builds</li>
<li><strong>Status icons</strong> - {{ success_required_icon_html|safe }} passed / {{ failure_required_icon_html|safe }} failed / {{ in_progress_icon_html|safe }} building</li>
<li><strong>Click IMAGE</strong> - Opens latest build report, <strong>üìã</strong> shows history</li>
<li><strong><svg height="14" width="14" viewBox="0 0 16 16" fill="#24292f" style="display: inline-block; vertical-align: middle;"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></strong> - Opens GitHub commit/checks</li>
<li><strong>üê≥</strong> - Searches NVIDIA GitLab Docker registry</li>
<li><strong>‚ñ∂</strong> - Expands row details</li>
</ul>
</div>
</div>
</div>
</details>
</div>

<div class="container">
{# Default UX: collapse Image SHA + GitLab Status columns on first load (users can re-enable via checkbox / URL state / localStorage). #}
<table id="commits-table" class="hide-col-composite hide-col-gitlab hide-col-email">
<thead>
<tr>
<th style="width: 30px;"></th>
<th>Commit SHA</th>
{# Column header layout policy: checkbox, icon, description (in that order). #}
{# NOTE: `data-url-state="1"` opts into URL syncing (common_dashboard.j2 DashboardUrlState). #}
{# We keep desired defaults in `data-url-default` so the JS can override browser form restoration. #}
<th class="col-composite"><label class="col-toggle"><input class="commit-col-toggle" type="checkbox" data-col="composite" data-url-state="1" data-url-default="0" data-url-key="col.composite" onchange="toggleCommitColumn(this)"><span class="col-icon" title="Image SHA"></span><span class="col-title-text">Image SHA</span></label></th>
<th class="col-github"><label class="col-toggle"><input class="commit-col-toggle" type="checkbox" checked data-col="github" data-url-state="1" data-url-default="1" data-url-key="col.github" onchange="toggleCommitColumn(this)"><span class="col-icon" title="GitHub Status"><svg height="14" width="14" viewBox="0 0 16 16" fill="currentColor" style="display: inline-block; vertical-align: middle;"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></span><span class="col-title-text">GitHub Status</span></label></th>
<th class="col-gitlab"><label class="col-toggle"><input class="commit-col-toggle" type="checkbox" data-col="gitlab" data-url-state="1" data-url-default="0" data-url-key="col.gitlab" onchange="toggleCommitColumn(this)"><span class="col-icon" title="GitLab Status">ü¶ä</span><span class="col-title-text">GitLab Status</span></label></th>
<th class="col-date">
  <span class="date-header-controls">
    <label class="col-toggle">
      <input class="commit-col-toggle" type="checkbox" checked data-col="date" data-url-state="1" data-url-default="1" data-url-key="col.date" onchange="toggleCommitColumn(this)">
      <span class="col-title">PST</span>
    </label>
    <label class="col-toggle" title="Toggle absolute time vs time ago">
      <input class="commit-date-mode-toggle" type="checkbox" data-url-state="1" data-url-default="0" data-url-key="date.mode" onchange="toggleCommitDateMode(this)">
      <span class="col-title">ago</span>
    </label>
  </span>
</th>
<th class="col-author"><label class="col-toggle"><input class="commit-col-toggle" type="checkbox" checked data-col="author" data-url-state="1" data-url-default="1" data-url-key="col.author" onchange="toggleCommitColumn(this)"><span class="col-icon" title="Author">üë§</span><span class="col-title-text">Author</span></label></th>
<th class="col-email"><label class="col-toggle"><input class="commit-col-toggle" type="checkbox" data-col="email" data-url-state="1" data-url-default="0" data-url-key="col.email" onchange="toggleCommitColumn(this)"><span class="col-icon" title="Email">üìß</span><span class="col-title-text">Email</span></label></th>
<th class="col-message"><label class="col-toggle"><input class="commit-col-toggle" type="checkbox" checked data-col="message" data-url-state="1" data-url-default="1" data-url-key="col.message" onchange="toggleCommitColumn(this)"><span class="col-title-text">Message</span></label></th>
</tr>
</thead>
<tbody>

{# Build a mapping of composite_sha to color index (0-7) #}
{# Group commits by their Image SHA and assign a color to each group #}
{%- set composite_sha_to_color = {} -%}
{%- set seen_composite_shas = [] -%}
{%- for commit in commits -%}
  {%- if commit.composite_sha not in composite_sha_to_color -%}
    {%- set _ = seen_composite_shas.append(commit.composite_sha) -%}
    {%- set color_index = (seen_composite_shas|length - 1) % 8 -%}
    {%- set _ = composite_sha_to_color.update({commit.composite_sha: color_index}) -%}
  {%- endif -%}
{%- endfor -%}

{% for commit in commits %}
{%- set sha_short = commit.sha_short -%}
{%- set sha_full = commit.sha_full -%}
{%- set composite_sha = commit.composite_sha -%}
{%- set date_str = commit.date -%}
{%- set author = commit.author -%}
{%- set author_email = commit.author_email | default('') -%}
{%- set message = commit.message -%}
{%- set commit_link = "https://github.com/ai-dynamo/dynamo/commit/" ~ sha_full -%}
{%- set gitlab_commit_link = "https://gitlab-master.nvidia.com/dl/ai-dynamo/dynamo/-/commit/" ~ sha_full -%}
{%- set has_docker_images = sha_short in docker_images and docker_images[sha_short] -%}
{%- set has_gitlab = sha_full in gitlab_images and gitlab_images[sha_full] -%}
{%- set gitlab_imgs = gitlab_images.get(sha_full, []) -%}
{%- set composite_bg_color = commit.composite_bg_color -%}
{%- set pipeline = gitlab_pipelines.get(sha_full) -%}
{%- set pr_number = commit.pr_number -%}
{%- set mr_pipeline = mr_pipelines.get(pr_number) if pr_number else none -%}
{%- set effective_pipeline = pipeline if pipeline else mr_pipeline -%}
{%- set sha_color_class = "sha-color-" ~ composite_sha_to_color.get(composite_sha, 0) -%}
{%- set full_msg = commit.full_message -%}
{%- set files_changed = commit.files_changed -%}
{%- set insertions = commit.insertions -%}
{%- set deletions = commit.deletions -%}
{%- set changed_files = commit.changed_files -%}

<tr>
<td style="padding: 4px 4px 4px 8px;">
<a href="#"
   id="commit-info-toggle-{{ sha_short }}"
   class="triangle-toggle"
   onclick="toggleCommitInfo(event, '{{ sha_short }}'); return false;"
   style="margin-right: 0;"
   title="Show commit message and file changes">‚ñ∂</a>
</td>
<td class="sha">
<a href="{{ commit_link }}" target="_blank" class="{{ sha_color_class }}">{{ sha_short }}</a>
</td>
<td class="sha col-composite"><span class="col-body">
{%- set log_paths_list = log_paths.get(sha_short, []) -%}
{%- set status_info = build_status.get(sha_short, {}) -%}
{%- set status = status_info.get('status', 'unknown') -%}
{%- set inherited = status_info.get('inherited', False) -%}
{# Image SHA dropdown should only contain Image-SHA/local-image related info. GitLab registry info belongs to GitLab dropdown. #}
{%- set has_composite_toggle = has_docker_images -%}
{# Expand/collapse triangle MUST be the first element in the cell (greyed out if nothing to expand). #}
{%- if has_composite_toggle -%}
<a href="#"
   id="docker-toggle-{{ sha_short }}"
   data-sha-short="{{ sha_short }}"
   class="triangle-toggle"
   onclick="toggleDockerImages(event, this); return false;"
   style="margin-right: 4px;"
   title="Show Docker images">‚ñ∂</a>
{%- else -%}
<span class="triangle-toggle disabled" style="margin-right: 4px;" title="No Docker images">‚ñ∂</span>
{%- endif -%}
{# Local build status coloring on IMAGE:... label (no extra chip/box). #}
{%- if log_paths_list -%}
{# Most recent build (last in list) #}
{%- set latest_date, latest_path = log_paths_list[-1] -%}
{# UX: IMAGE badge is the link. #}
{%- set cds_label = "IMAGE:" ~ composite_sha[:6] -%}
{%- if commit.image_status_icon -%}{{ commit.image_status_icon|safe }} {%- endif -%}<a href="{{ latest_path }}" target="_blank" class="image-sha-badge" title="{%- if inherited -%}Inherited: {%- endif -%}{%- if status == 'success' -%}All local builds passed{%- elif status == 'failed' -%}Some local builds failed{%- else -%}Build in progress / no local build status{%- endif -%} - Click to view build logs">{{ cds_label }}</a>
{# Show history icon if multiple builds exist #}
{%- if log_paths_list|length > 1 -%}
<a href="#" onclick="toggleBuildHistory(event, '{{ sha_short }}'); return false;" style="text-decoration: none; margin-left: 2px; font-size: 11px; color: #656d76;" title="Show build history ({{ log_paths_list|length }} builds)">üìã</a>
<div id="build-history-{{ sha_short }}" style="display: none; position: absolute; background: #fff; border: 1px solid #d0d7de; border-radius: 6px; padding: 8px; margin-top: 4px; z-index: 1000; box-shadow: 0 8px 24px rgba(140, 149, 159, 0.2);">
  <div style="font-weight: 600; font-size: 12px; margin-bottom: 6px; color: #24292f;">Build History</div>
  {%- for date, path in log_paths_list|reverse -%}
  <div style="padding: 4px 0;">
    <a href="{{ path }}" target="_blank" style="color: #0969da; text-decoration: none; font-size: 12px;">{{ date }}</a>{%- if loop.first -%} <span style="color: #656d76; font-size: 11px;">(latest)</span>{%- endif -%}
  </div>
  {%- endfor -%}
</div>
{%- endif -%}
{%- else -%}
{# No build logs: still render the IMAGE badge (not a link) with the status icon. #}
{%- set cds_label = "IMAGE:" ~ composite_sha[:6] -%}
{%- if commit.image_status_icon -%}{{ commit.image_status_icon|safe }} {%- endif -%}<span class="image-sha-badge" title="{%- if inherited -%}Inherited: {%- endif -%}{%- if status == 'success' -%}All local builds passed{%- elif status == 'failed' -%}Some local builds failed{%- else -%}Build in progress / no local build status{%- endif -%}">{{ cds_label }}</span>
{%- endif -%}
</span></td>
</td>
<td class="sha col-github"><span class="col-body">
<span class="github-icons">
{# GitHub Actions status for GHA badge color #}
{%- set gha_status = github_actions_status.get(sha_full) -%}
{%- if gha_status and gha_status.conclusion == 'success' -%}
{%- set gha_color = '#2da44e' -%}
{%- set gha_title = 'GitHub Actions: All checks passed' -%}
{%- elif gha_status and gha_status.conclusion == 'failure' -%}
{%- set gha_color = '#c83a3a' -%}
{%- set gha_title = 'GitHub Actions: Some checks failed' -%}
{%- elif gha_status and gha_status.status == 'in_progress' -%}
{%- set gha_color = '#8c959f' -%}
{%- set gha_title = 'GitHub Actions: Checks in progress' -%}
{%- elif gha_status and gha_status.conclusion == 'cancelled' -%}
{%- set gha_color = '#8c959f' -%}
{%- set gha_title = 'GitHub Actions: Checks cancelled' -%}
{%- else -%}
{%- set gha_color = '#8c959f' -%}
{%- set gha_title = 'GitHub Actions: No checks' -%}
{%- endif -%}
{# GitHub section #}
{%- if commit.github_checks_tree_html -%}<a href="#"
   id="github-tree-toggle-{{ sha_short }}"
   class="triangle-toggle"
   onclick="toggleCommitGitHubTree(event, '{{ sha_short }}'); return false;"
   title="Show GitHub checks tree">‚ñ∂</a>{%- else -%}<span class="triangle-toggle disabled" title="No GitHub checks available">‚ñ∂</span>{%- endif -%}<a href="https://github.com/ai-dynamo/dynamo/commit/{{ sha_full }}/checks" target="_blank" class="github-commit-link" style="text-decoration: none; color: #24292f; font-weight: 600;" title="{{ gha_title }}"><svg height="14" width="14" viewBox="0 0 16 16" fill="currentColor" style="display: inline-block; vertical-align: middle;"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"></path></svg></a>
{# Expandable per-commit checks tree (GitHub + GitLab) #}
{# Per-commit GH checks status (split required vs optional failures, plus pending vs cancelled) #}
{%- set commit_stats = gha_per_commit_stats.get(sha_full, {'success_required': 0, 'success_optional': 0, 'failure_required': 0, 'failure_optional': 0, 'in_progress_required': 0, 'in_progress_optional': 0, 'pending': 0, 'cancelled': 0, 'other': 0, 'total': 0}) -%}
{%- if commit_stats.total > 0 -%}
{# Build detailed tooltip with job names #}
{%- set gha_status = github_actions_status.get(sha_full) -%}
{%- set passed_required_jobs = [] -%}
{%- set passed_optional_jobs = [] -%}
{%- set failed_required_jobs = [] -%}
{%- set failed_optional_jobs = [] -%}
{%- set progress_required_jobs = [] -%}
{%- set progress_optional_jobs = [] -%}
{%- set pending_jobs = [] -%}
{%- set cancelled_jobs = [] -%}
{%- set other_jobs = [] -%}
{%- if gha_status and gha_status.get('check_runs') -%}
{%- for check in gha_status.get('check_runs', []) -%}
{%- if check.conclusion == 'success' -%}
{%- if check.is_required -%}
{%- set _ = passed_required_jobs.append(check.short_name) -%}
{%- else -%}
{%- set _ = passed_optional_jobs.append(check.short_name) -%}
{%- endif -%}
{%- elif check.conclusion in ('failure', 'timed_out', 'action_required') -%}
{%- if check.is_required -%}
{%- set _ = failed_required_jobs.append(check.short_name) -%}
{%- else -%}
{%- set _ = failed_optional_jobs.append(check.short_name) -%}
{%- endif -%}
{%- elif check.status == 'in_progress' -%}
{%- if check.is_required -%}
{%- set _ = progress_required_jobs.append(check.short_name) -%}
{%- else -%}
{%- set _ = progress_optional_jobs.append(check.short_name) -%}
{%- endif -%}
{%- elif check.status in ('queued', 'pending') -%}
{%- set _ = pending_jobs.append(check.short_name) -%}
{%- elif check.conclusion == 'cancelled' -%}
{%- set _ = cancelled_jobs.append(check.short_name) -%}
{%- else -%}
{%- set _ = other_jobs.append(check.short_name) -%}
{%- endif -%}
{%- endfor -%}
{%- endif -%}
{%- set tooltip_html_parts = [] -%}
{%- if passed_required_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #2da44e;">' ~ success_required_icon_html ~ ' Passed (required):</strong> ' ~ ((passed_required_jobs|sort)|join(', '))) -%}{%- endif -%}
{%- if passed_optional_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #2da44e;">' ~ success_icon_html ~ ' Passed (optional):</strong> ' ~ ((passed_optional_jobs|sort)|join(', '))) -%}{%- endif -%}
{%- if failed_required_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #c83a3a;">' ~ failure_required_icon_html ~ ' Failed (required):</strong> ' + (failed_required_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if failed_optional_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #c83a3a;">' ~ failure_optional_icon_html ~ ' Failed (optional):</strong> ' + (failed_optional_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if progress_required_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #8c959f;">' ~ in_progress_icon_html ~ ' In Progress (required):</strong> ' + (progress_required_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if progress_optional_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #8c959f;">' ~ in_progress_icon_html ~ ' In Progress (optional):</strong> ' + (progress_optional_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if pending_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #8c959f;">' ~ pending_icon_html ~ ' Pending:</strong> ' + (pending_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if cancelled_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #8c959f;">' ~ cancelled_icon_html ~ ' Canceled:</strong> ' + (cancelled_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if other_jobs -%}{%- set _ = tooltip_html_parts.append('<strong style="color: #8c959f;">Other:</strong> ' + (other_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- set tooltip_html = tooltip_html_parts|join('<br>') -%}
<span class="gh-status-tooltip">
<span style="white-space: nowrap; font-weight: 600; font-size: 11px;">
{%- set success_total = (commit_stats.success_required | int) + (commit_stats.success_optional | int) -%}
{{ compact_ci_summary_html(
  success_required=commit_stats.success_required,
  success_optional=commit_stats.success_optional,
  failure_required=commit_stats.failure_required,
  failure_optional=commit_stats.failure_optional,
  in_progress_required=commit_stats.in_progress_required,
  in_progress_optional=commit_stats.in_progress_optional,
  pending=commit_stats.pending,
  cancelled=commit_stats.cancelled
) | safe }}
</span>
<span class="tooltiptext">{{ tooltip_html|safe }}</span>
</span>
{%- endif -%}
</span></span></td>
</td>
<td class="sha col-gitlab"><span class="col-body">
{# GitLab section #}
<span class="gitlab-icons">{# keep icons adjacent; avoid whitespace nodes inside inline-flex #}
{%- if commit.gitlab_checks_tree_html -%}
<a href="#" 
   id="gitlab-tree-toggle-{{ sha_short }}" 
   class="triangle-toggle{% if not effective_pipeline %} icon-muted{% endif %}" 
   onclick="toggleCommitGitLabTree(event, '{{ sha_short }}'); return false;" 
   style="margin-right: 4px;" 
   title="{% if effective_pipeline %}Show GitLab pipeline jobs tree{% else %}No pipeline found (tree is likely empty){% endif %}">‚ñ∂</a>
{%- else -%}
<span class="triangle-toggle disabled" style="margin-right: 4px;" title="No GitLab pipeline available">‚ñ∂</span>
{%- endif -%}
{# Always show GitLab commit link (fox). Gray it out if we don't have pipeline context. #}
<a href="{{ gitlab_commit_link }}" target="_blank" class="icon-link gitlab-commit-link{%- if not effective_pipeline -%} icon-muted{%- endif -%}" style="color: #fc6d26; font-weight: 600;" title="View commit in GitLab">ü¶ä</a><a href="https://gitlab-master.nvidia.com/dl/ai-dynamo/dynamo/container_registry/85325?orderBy=PUBLISHED_AT&sort=desc&search%5B%5D={{ sha_full }}" target="_blank" class="icon-link gitlab-registry-link{% if not effective_pipeline %} icon-muted{% endif %}" style="color: {% if effective_pipeline %}#2496ed{% else %}#8c959f{% endif %}; font-weight: 600;" title="{% if effective_pipeline %}Search GitLab Docker registry for this SHA{% else %}No GitLab pipeline context (search registry anyway){% endif %}">üê≥</a>

{# Pipeline icon (build link). Uses SHA pipeline if present, else MR pipeline as fallback. #}
{%- if effective_pipeline and effective_pipeline.web_url -%}
<a href="{{ effective_pipeline.web_url }}" target="_blank" class="icon-link" style="color: #0969da;" title="View build pipeline in GitLab">üõ†Ô∏è</a>
{%- else -%}
<span class="icon-link icon-muted" title="No pipeline found for this commit/PR">üõ†Ô∏è</span>
{%- endif -%}
 </span>

{%- if pipeline -%}
{%- set job_data = pipeline_job_counts.get(pipeline.id) -%}
{%- if job_data -%}
{# Handle both old format (direct counts) and new format (counts + jobs) #}
{%- if job_data.counts -%}
{# New format: {'counts': {...}, 'jobs': [...]} #}
{%- set job_counts = job_data.counts -%}
{%- set has_job_details = job_data.jobs is defined and job_data.jobs -%}
{%- else -%}
{# Old format: {'success': N, 'failed': N, ...} - treat as counts directly #}
{%- set job_counts = job_data -%}
{%- set has_job_details = false -%}
{%- endif -%}
{# Build detailed tooltip with job names if available #}
{%- if has_job_details -%}
{%- set success_jobs = [] -%}
{%- set failed_required_jobs = [] -%}
{%- set failed_optional_jobs = [] -%}
{%- set running_required_jobs = [] -%}
{%- set running_optional_jobs = [] -%}
{%- set pending_jobs = [] -%}
{%- set canceled_jobs = [] -%}
{%- for job in job_data.jobs -%}
{# Mandatory job names: contains ".pre" OR starts with "build" OR starts with "test" #}
{%- set job_name = job.name or "" -%}
{%- set job_stage_raw = (job.stage if job.stage is defined else "") or "unknown" -%}
{# GitLab stage "pre" is typically shown as ".pre" in the UI; normalize for readability #}
{%- set job_stage = ".pre" if job_stage_raw == "pre" else job_stage_raw -%}
{%- set job_label = job_stage ~ "." ~ job_name -%}
{# Mandatory are: .pre, build, test (match on either stage or full label) #}
{%- set is_required = (job_name.startswith(".pre") or (".pre" in job_label) or (job_stage in ("pre", ".pre")) or job_name.startswith("build") or job_name.startswith("test")) -%}
{%- if job.status == 'success' -%}
{%- set _ = success_jobs.append(job_label) -%}
{%- elif job.status == 'failed' -%}
{%- if is_required -%}
{%- set _ = failed_required_jobs.append(job_label) -%}
{%- else -%}
{%- set _ = failed_optional_jobs.append(job_label) -%}
{%- endif -%}
{%- elif job.status == 'running' -%}
{%- if is_required -%}
{%- set _ = running_required_jobs.append(job_label) -%}
{%- else -%}
{%- set _ = running_optional_jobs.append(job_label) -%}
{%- endif -%}
{%- elif job.status in ('pending', 'created', 'waiting_for_resource') -%}
{%- set _ = pending_jobs.append(job_label) -%}
{%- elif job.status == 'canceled' -%}
{%- set _ = canceled_jobs.append(job_label) -%}
{%- endif -%}
{%- endfor -%}
{%- set gitlab_tooltip_parts = [] -%}
{# Use the same circled-check icon as GitHub for "passed" in tooltips #}
{%- if success_jobs -%}{%- set _ = gitlab_tooltip_parts.append('<strong style="color: #2da44e;">' ~ success_icon_html ~ ' Passed:</strong> ' ~ ((success_jobs|sort)|join(', '))) -%}{%- endif -%}
{%- if failed_required_jobs -%}{%- set _ = gitlab_tooltip_parts.append('<strong style="color: #c83a3a;">' ~ failure_required_icon_html ~ ' Failed (mandatory):</strong> ' + (failed_required_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if failed_optional_jobs -%}{%- set _ = gitlab_tooltip_parts.append('<strong style="color: #c83a3a;">' ~ failure_optional_icon_html ~ ' Failed (non-mandatory):</strong> ' + (failed_optional_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if running_required_jobs -%}{%- set _ = gitlab_tooltip_parts.append('<strong style="color: #8c959f;">' ~ in_progress_icon_html ~ ' In Progress (mandatory):</strong> ' + (running_required_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if running_optional_jobs -%}{%- set _ = gitlab_tooltip_parts.append('<strong style="color: #8c959f;">' ~ in_progress_icon_html ~ ' In Progress (non-mandatory):</strong> ' + (running_optional_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if pending_jobs -%}{%- set _ = gitlab_tooltip_parts.append('<strong style="color: #8c959f;">' ~ pending_icon_html ~ ' Pending:</strong> ' + (pending_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- if canceled_jobs -%}{%- set _ = gitlab_tooltip_parts.append('<strong style="color: #8c959f;">' ~ cancelled_icon_html ~ ' Canceled:</strong> ' + (canceled_jobs|sort)|join(', ')) -%}{%- endif -%}
{%- set gitlab_tooltip_html = gitlab_tooltip_parts|join('<br>') -%}
<span class="gh-status-tooltip" style="margin-left: 4px;">
<span style="white-space: nowrap; font-weight: 600; font-size: 11px;">
{%- if job_counts.success > 0 -%}<span style="color: #2da44e;">{{ job_counts.success }}</span>{{ success_icon_html|safe }}{%- endif -%}
{%- set req_failed = failed_required_jobs|length -%}
{%- set opt_failed = failed_optional_jobs|length -%}
{%- set inprog_total = (running_required_jobs|length) + (running_optional_jobs|length) -%}
{%- if req_failed > 0 -%}{%- if job_counts.success > 0 %} {% endif -%}<span style="color: #c83a3a; font-weight: 800; font-size: 12px;" title="Mandatory failures">{{ req_failed }}</span>{{ failure_required_icon_html|safe }}{%- endif -%}
{%- if opt_failed > 0 -%}{%- if job_counts.success > 0 or req_failed > 0 %} {% endif -%}<span style="color: #c83a3a;" title="Non-mandatory failures">{{ opt_failed }}</span>{{ failure_optional_icon_html|safe }}{%- endif -%}
{%- if inprog_total > 0 -%}{%- if job_counts.success > 0 or req_failed > 0 or opt_failed > 0 %} {% endif -%}<span style="color: #8c959f;">{{ inprog_total }}</span>{{ in_progress_icon_html|safe }}{%- endif -%}
{%- if job_counts.pending > 0 -%}{%- if job_counts.success > 0 or req_failed > 0 or opt_failed > 0 or inprog_total > 0 %} {% endif -%}<span style="color: #8c959f;">{{ job_counts.pending }}</span>{{ pending_icon_html|safe }}{%- endif -%}
{%- if job_counts.canceled > 0 -%}{%- if job_counts.success > 0 or req_failed > 0 or opt_failed > 0 or inprog_total > 0 or job_counts.pending > 0 %} {% endif -%}<span style="color: #8c959f;">{{ job_counts.canceled }}</span>{{ cancelled_icon_html|safe }}{%- endif -%}
</span>
{%- if gitlab_tooltip_html -%}
<span class="tooltiptext">{{ gitlab_tooltip_html|safe }}</span>
{%- endif -%}
</span>
{%- else -%}
{# Old format or no job details - just show counts without tooltip #}
<a href="{{ pipeline.web_url }}" target="_blank" style="margin-left: 4px; text-decoration: none; font-weight: 600; font-size: 11px;" title="Click to view pipeline">
{%- if job_counts.success > 0 -%}<span style="color: #2da44e;">{{ job_counts.success }}</span>{{ success_icon_html|safe }}{%- endif -%}
{%- if job_counts.failed > 0 -%}{%- if job_counts.success > 0 %} {% endif -%}<span style="color: #c83a3a;">{{ job_counts.failed }}</span>{{ failure_required_icon_html|safe }}{%- endif -%}
{%- if job_counts.running > 0 -%}{%- if job_counts.success > 0 or job_counts.failed > 0 %} {% endif -%}<span style="color: #8c959f;">{{ job_counts.running }}</span>{{ in_progress_icon_html|safe }}{%- endif -%}
{%- if job_counts.pending > 0 -%}{%- if job_counts.success > 0 or job_counts.failed > 0 or job_counts.running > 0 %} {% endif -%}<span style="color: #8c959f;">{{ job_counts.pending }}</span>{{ pending_icon_html|safe }}{%- endif -%}
{%- if job_counts.canceled > 0 -%}{%- if job_counts.success > 0 or job_counts.failed > 0 or job_counts.running > 0 or job_counts.pending > 0 %} {% endif -%}<span style="color: #8c959f;">{{ job_counts.canceled }}</span>{{ cancelled_icon_html|safe }}{%- endif -%}
</a>
{%- endif -%}
{%- endif -%}
{%- endif -%}
</span></td>
</td>
<td class="date col-date">
  <span class="col-body">
    <span class="dt-abs">{{ date_str }}</span>
    <span class="dt-ago" data-epoch="{{ commit.date_epoch | default(0) }}" style="display: none;"></span>
  </span>
</td>
<td class="author col-author"><span class="col-body">{{ author }}</span></td>
<td class="col-email"><span class="col-body" style="color: #57606a; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; font-size: 12px;">{{ author_email }}</span></td>
<td class="col-message"><span class="col-body">
<div class="message">{{ message | safe }}</div>
{%- if commit.release_forkpoints -%}
<div style="margin-top: 2px;">
{%- for fp in commit.release_forkpoints -%}
<a class="release-forkpoint" href="{{ fp.url }}" target="_blank" title="Fork-point for {{ fp.branch }}">{{ fp.label }}</a>
{%- endfor -%}
</div>
{%- endif -%}
</span></td>
</td>
</tr>

{# Commit info dropdown row (message, files changed, stats) #}
<tr class="commit-info-row" id="commit-info-row-{{ sha_short }}" style="display: none;">
<td colspan="9" style="padding: 0; background-color: #f6f8fa;">
<div style="padding: 8px 12px; border-top: 1px solid #d0d7de;">
  <div style="display: flex; align-items: center; justify-content: flex-start; margin-bottom: 6px;">
    <button type="button"
            onclick="event.stopPropagation(); try { collapseCommitInfo('{{ sha_short }}'); } catch (e) {}"
            style="padding: 0 6px; height: 18px; line-height: 16px; font-size: 14px; border: 1px solid #d0d7de; border-radius: 999px; background: #ffffff; color: #57606a; cursor: pointer;"
            title="Close commit info"><svg aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="12" height="12" data-view-component="true" class="octicon octicon-x" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 11-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg></button>
  </div>
  <div style="margin: 0; padding: 0 14px;">
    <div style="margin: 8px 0 12px 0; padding: 8px; background-color: white; border: 1px solid #d0d7de; border-radius: 4px;">
      <div style="font-weight: 600; margin-bottom: 6px; font-size: 13px;">Commit Message:</div>
      <div style="font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; font-size: 12px; color: #24292f; white-space: pre-wrap; margin-bottom: 8px;">{{ full_msg | e }}</div>
      <div style="font-size: 12px; color: #57606a; margin-top: 6px;">
        <span style="color: #1a7f37; font-weight: 500;">+{{ insertions }}</span>
        <span style="color: #cf222e; font-weight: 500;">-{{ deletions }}</span>
        <span style="margin-left: 8px;">{{ files_changed }} file(s) changed</span>
      </div>
      <details style="margin-top: 8px;" open>
        {{ summary_with_toggle('Show changed files (' ~ changed_files|length ~ ')', 'style="cursor: pointer; color: #0969da; font-size: 12px;"') }}
        <div class="details-body">
          <div style="margin-top: 4px; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; font-size: 11px;">
            {% for file in changed_files %}
            <div style="padding: 2px 0;">{{ file }}</div>
            {% endfor %}
          </div>
        </div>
      </details>
    </div>
  </div>
</div>
</td>
</tr>

{# GitHub checks tree row (hidden by default) #}
{%- if commit.github_checks_tree_html -%}
<tr id="github-tree-row-{{ sha_short }}" style="display: none;">
<td colspan="9" style="padding: 0;">
<div style="padding: 0; border-top: 0;">
          <div style="display: flex; align-items: center; justify-content: flex-start; padding: 6px 8px 0 8px;">
            <button type="button"
                    onclick="event.stopPropagation(); try { collapseCommitGitHubTree('{{ sha_short }}'); } catch (e) {}"
                    style="padding: 0 6px; height: 18px; line-height: 16px; font-size: 14px; border: 1px solid #d0d7de; border-radius: 999px; background: #ffffff; color: #57606a; cursor: pointer;"
                    title="Close GitHub checks"><svg aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="12" height="12" data-view-component="true" class="octicon octicon-x" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 11-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg></button>
          </div>
          <div style="margin: 0; padding: 0 0 0 14px;">{{ commit.github_checks_tree_html | safe }}</div>
</div>
</td>
</tr>
{%- endif -%}

{# GitLab dropdown row (hidden by default): GitLab + commit details + registry info. #}
{%- if commit.gitlab_checks_tree_html or has_gitlab -%}
<tr id="gitlab-tree-row-{{ sha_short }}" style="display: none;">
<td colspan="9" style="padding: 0;">
<div style="padding: 0; border-top: 0;">
          <div style="display: flex; align-items: center; justify-content: flex-start; padding: 6px 8px 0 8px;">
            <button type="button"
                    onclick="event.stopPropagation(); try { collapseCommitGitLabTree('{{ sha_short }}'); } catch (e) {}"
                    style="padding: 0 6px; height: 18px; line-height: 16px; font-size: 14px; border: 1px solid #d0d7de; border-radius: 999px; background: #ffffff; color: #57606a; cursor: pointer;"
                    title="Close GitLab pipeline"><svg aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="12" height="12" data-view-component="true" class="octicon octicon-x" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 11-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg></button>
          </div>
          <div style="margin: 0; padding: 0 14px;">
            {# GitLab Container Registry Section (belongs to GitLab dropdown) #}
            {% if gitlab_imgs %}
            <div style="margin-bottom: 12px;">
              <div style="font-weight: 600; margin-bottom: 4px; font-size: 13px;">GitLab Container Registry (Runtime Images): <a href="https://gitlab-master.nvidia.com/dl/ai-dynamo/dynamo/container_registry/{{ gitlab_imgs[0].registry_id }}" target="_blank" style="color: #fc6d26; text-decoration: none; font-weight: 600; font-size: 12px;" title="View all images in GitLab Container Registry">ü¶ä View Registry</a></div>
              <table style="width: 100%; border: none; background-color: white; border-collapse: collapse;">
                <thead>
                  <tr>
                    <th style="width: 35%; padding: 3px 6px; border: none;">Image Name:Tag</th>
                    <th style="width: 10%; padding: 3px 6px; border: none;">pull runtime</th>
                    <th style="width: 10%; padding: 3px 6px; border: none;">Build ID</th>
                    <th style="width: 8%; padding: 3px 6px; border: none;">Size</th>
                    <th style="width: 27%; padding: 3px 6px; border: none;">Created (PDT)</th>
                  </tr>
                </thead>
                <tbody>
                  {% for img in gitlab_imgs %}
                  {%- set arch_label = "[x86]" if img.arch == "amd64" else "[ARM]" -%}
                  {%- set display_tag = arch_label ~ " " ~ img.tag -%}
                  {%- set image_id = img.pipeline_id[:12] if img.pipeline_id|length >= 12 else img.pipeline_id -%}
                  <tr>
                    <td style="font-family: monospace; font-size: 11px; padding: 2px 6px; border: none; max-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{ img.tag }}
Pipeline: {{ img.pipeline_id }}
Framework: {{ img.framework }}">{{ display_tag }}</td>
                    <td style="font-size: 11px; padding: 2px 6px; border: none; white-space: nowrap;"><button data-clipboard-text="docker pull {{ img.location }}" onclick="copyFromClipboardAttr(this)" style="padding: 4px 6px; font-size: 11px; background-color: transparent; color: #57606a; border: 1px solid #d0d7de; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; vertical-align: middle;" title="Click to copy docker pull command for runtime image" onmouseover="this.style.backgroundColor='#f3f4f6'; this.style.borderColor='#8c959f';" onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='#d0d7de';"><svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="display: inline-block;">{% include "copy_icon_paths.svg" %}</svg></button><span style="margin-left: 6px;">copy command</span></td>
                    <td style="font-family: monospace; font-size: 11px; padding: 2px 6px; border: none;"><a href="https://gitlab-master.nvidia.com/dl/ai-dynamo/dynamo/-/pipelines/{{ img.pipeline_id }}" target="_blank" style="color: #0969da;" title="View pipeline {{ img.pipeline_id }}">{{ image_id }}</a></td>
                    <td style="font-size: 11px; padding: 2px 6px; border: none;">{{ img.size_display }}</td>
                    <td style="font-size: 11px; padding: 2px 6px; border: none;">{{ img.created_display }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% endif %}

            {%- if commit.gitlab_checks_tree_html -%}
            <div style="margin: 0; padding: 0 0 0 0;">{{ commit.gitlab_checks_tree_html | safe }}</div>
            {%- endif -%}
          </div>
</div>
</td>
</tr>
{%- endif -%}

{# Docker images row (Image SHA dropdown) if any LOCAL docker images exist for this SHA #}
{% if has_docker_images %}
{%- set images = docker_images.get(sha_short, []) -%}

<tr class="docker-images-row" id="docker-row-{{ sha_short }}" style="display: none;">
<td colspan="9" style="padding: 0; background-color: #f6f8fa;">
<div style="padding: 8px 12px; border-top: 1px solid #d0d7de;">
<div style="display: flex; align-items: center; justify-content: flex-start; margin-bottom: 6px;">
  <button type="button"
          onclick="event.stopPropagation(); try { collapseDockerImages('{{ sha_short }}'); } catch (e) {}"
          style="padding: 0 6px; height: 18px; line-height: 16px; font-size: 14px; border: 1px solid #d0d7de; border-radius: 999px; background: #ffffff; color: #57606a; cursor: pointer;"
          title="Close Docker images"><svg aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="12" height="12" data-view-component="true" class="octicon octicon-x" fill="currentColor"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 11-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg></button>
</div>
<!-- Docker Images Section -->
{% if images %}
<div style="margin-bottom: 12px; padding: 8px; background-color: white; border: 1px solid #d0d7de; border-radius: 4px;">
<div style="font-weight: 600; margin-bottom: 4px; font-size: 13px;">Local Docker Images:</div>
<table style="width: 100%; border: none; background-color: white; border-collapse: collapse;">
<thead>
<tr>
<th style="width: 50%; padding: 3px 6px; border: none;">Image Name:Tag</th>
<th style="width: 15%; padding: 3px 6px; border: none;">Image ID</th>
<th style="width: 10%; padding: 3px 6px; border: none;">Size</th>
<th style="width: 25%; padding: 3px 6px; border: none;">Created (PDT)</th>
</tr>
</thead>
<tbody>
{% for image in images | sort(attribute='tag') %}
<tr>
<td style="font-family: monospace; font-size: 11px; padding: 2px 6px; border: none;">{{ image.tag }}</td>
<td style="font-family: monospace; font-size: 11px; padding: 2px 6px; border: none;">{{ image.id }}</td>
<td style="font-size: 11px; padding: 2px 6px; border: none;">{{ image.size }}</td>
<td style="font-size: 11px; padding: 2px 6px; border: none;">{{ image.created }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
{% endif %}

</div>
</td>
</tr>
{% endif %}

{% endfor %}

</tbody>
</table>
</div>
{% endblock %}

